---
layout: post
title: 氢桌面：高德悬浮地图在滑动桌面时消失的记录
abbrlink: b9b8079ded7f47ae80046692d549cbd6
tags: []
categories:
  - framework
  - window
date: 1757642803606
updated: 1757642954755
---

## 背景

最近给自己的老油车升级系统，开放了第三方 App 安装。伙伴推荐使用“氢桌面”（支持高德悬浮地图）。实际体验中却发现：悬浮地图在桌面滑动切换时会消失，与预期有差异。

## 现象复现

> 静止状态：显示正常

![Screenshot\_20250912\_094724.png](/resources/e8898da56fd5462b80358b707a039db9.png)

> 滑动桌面过程中：悬浮地图消失

![Screenshot\_20250912\_094804.png](/resources/21e344ec75074cab8c6a33b6421989d5.png)

## 初步猜测

滑动时，可能移除了对应的 Surface 图层，于是用 Winscope 做了验证。

## Winscope 验证

> 不滑动时：导航图层仍存在、正常显示\
> 下一帧（滑动中）：对应的 Surface 图层消失

![773dff6f75d3c717ceffbbbbbec3d72f.png](/resources/d1b23c2b889640deb01311241d83dafd.png)
![f0404705bcea4a9670e30b0424b35dc8.png](/resources/bcbdd6c700c4424cb471a347912c2b44.png)

## 优化猜想

> 参考 Android 原生任务栈回退 / 恢复动画机制，给该地图层加一个“狗绳”动画（animation leash）。如果通过 Leash 临时托管图层，滑动过程中地图可能就不会直接消失。

![2595df4de782d62d7e81f8362c62e4da.png](/resources/adf1201d0b424b3589ae970c79c8c373.png)

> 目前效果可能是：由于老车机系统版本与性能限制，桌面实现上做了妥协。

***

（纯兴趣测试，App 为第三方展示用。）
